<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RAJA::expt::Launch Execution Policies &mdash; RAJA 2022.03.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Naming kernels for NVTX/ROCTX tools" href="launch_naming_kernels.html" />
    <link rel="prev" title="RAJA::expt::Launch Basics" href="launch_basic.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> RAJA
            <img src="../../../_static/RAJA_LOGO_CMYK_White_Background_large.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.03
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">RAJA User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">Getting Started With RAJA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using_raja.html">Using RAJA in Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config_options.html">Build Configuration Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features.html">RAJA Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app_considerations.html">Application Considerations</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorial.html">RAJA Tutorial and Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#raja-tutorial">RAJA Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#a-little-c-background">A Little C++ Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#raja-examples-and-exercises">RAJA Examples and Exercises</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#simple-loops-and-basic-raja-features">Simple Loops and Basic RAJA Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#complex-loops-and-advanced-raja-features">Complex Loops and Advanced RAJA Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#nested-loops-with-raja-kernel">Nested Loops with <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code></a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../tutorial.html#nested-loops-with-raja-expt-launch">Nested Loops with <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code></a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="launch_basic.html"><code class="docutils literal notranslate"><span class="pre">RAJA::expt::Launch</span></code> Basics</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">RAJA::expt::Launch</span></code> Execution Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="launch_naming_kernels.html">Naming kernels for NVTX/ROCTX tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#comparing-raja-kernel-and-raja-expt-launch-matrix-transpose">Comparing <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> and <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code>: Matrix-Transpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#other-raja-features-and-usage-examples">Other RAJA Features and Usage Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">RAJA Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../raja_license.html">RAJA Copyright and License Information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RAJA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">RAJA User Guide</a> &raquo;</li>
          <li><a href="../tutorial.html">RAJA Tutorial and Examples</a> &raquo;</li>
      <li><code class="docutils literal notranslate"><span class="pre">RAJA::expt::Launch</span></code> Execution Policies</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/sphinx/user_guide/tutorial/launch_exec_pols.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="raja-expt-launch-execution-policies">
<span id="tut-launchexecpols-label"></span><h1><code class="docutils literal notranslate"><span class="pre">RAJA::expt::Launch</span></code> Execution Policies<a class="headerlink" href="#raja-expt-launch-execution-policies" title="Permalink to this headline">¶</a></h1>
<p>This section contains an exercise file
<code class="docutils literal notranslate"><span class="pre">RAJA/exercises/launchintro-execpols.cpp</span></code> for you to work through if you
wish to get some practice with RAJA. The file
<code class="docutils literal notranslate"><span class="pre">RAJA/exercises/launchintro-execpols_solution.cpp</span></code> contains complete working
code for the examples discussed in this section. You can use the solution file
to check your work and for guidance if you get stuck. To build the exercises
execute <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">launchintro-execpols</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">launchintro-execpols_solution</span></code>
from the build directory.</p>
<p>Key RAJA features shown in this section are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> kernel execution environment template</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RAJA::expt::loop</span></code> loop execution template and execution policies</p></li>
</ul>
</div></blockquote>
<p>The examples in this section illustrate how to construct nested loop kernels
inside an <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> execution environment. In particular,
the goal is for you to gain an understanding of how to use execution policies
with nested <code class="docutils literal notranslate"><span class="pre">RAJA::expt::loop</span></code> method calls to perform various nested
loop execution patterns. All examples use the same simple kernel, which
is a three-level loop nest to initialize the entries in an array. The kernels
perform the same operations as the examples in <a class="reference internal" href="kernel_exec_pols.html#tut-kernelexecpols-label"><span class="std std-ref">RAJA::kernel Execution Policies</span></a>.
By comparing the two sets of examples, you will gain an understanding of the
differences between the <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> and the <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code>
interfaces.</p>
<p>We begin by defining some constants used throughout the examples and allocating
arrays to represent the array data:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span>
<span class="c1">// 3D tensor has N^3 entries</span>
<span class="c1">//</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N_tot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0001</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">memoryManager</span><span class="o">::</span><span class="n">allocate</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">N_tot</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">a_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">memoryManager</span><span class="o">::</span><span class="n">allocate</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">N_tot</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Note that we use the ‘memory manager’ routines contained in the exercise
directory to simplify the allocation process. In particular, CUDA unified
memory is used when CUDA is enabled to simplify accessing the data on the
host or device.</p>
<p>Next, we execute a C-style nested for-loop version of the kernel to initialize
the entries in the ‘reference’ array that we will use to compare the results
of other variants for correctness:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">k</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">a_ref</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">k</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that we manually compute the pointer offsets for the (i,j,k) indices.
To simplify the remaining kernel variants we introduce a <code class="docutils literal notranslate"><span class="pre">RAJA::View</span></code>
object, which wraps the array data pointer and simplifies the multi-dimensional
indexing:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">Layout</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">aView</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Here ‘aView’ is a three-dimensional View with extent ‘N’ in each
coordinate based on a three-dimensional <code class="docutils literal notranslate"><span class="pre">RAJA::Layout</span></code> object where the
array entries will be accessed using indices of type ‘int’.
indices of type <code class="docutils literal notranslate"><span class="pre">int</span></code>. Please see <a class="reference internal" href="../feature/view.html#feat-view-label"><span class="std std-ref">View and Layout</span></a> for more information
about the View and Layout types that RAJA provides for various indexing
patterns and data layouts.</p>
<p>Using the View, the C-style kernel looks like:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">k</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">aView</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Notice how accessing each (i,j,k) entry in the array is more natural,
and less error prone, using the View.</p>
<p>The corresponding RAJA sequential version using <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> is:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">loop_policy_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">loop_exec</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">launch_policy_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">seq_launch_t</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">launch</span><span class="o">&lt;</span><span class="n">launch_policy_1</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Grid</span><span class="p">(),</span><span class="w"> </span><span class="c1">//Grid may be empty when running on the host</span>
<span class="w">    </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="n">RAJA_HOST_DEVICE</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">loop_policy_1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">loop_policy_1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">loop_policy_1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">                </span><span class="n">aView</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="p">});</span><span class="w"></span>
<span class="w">         </span><span class="p">});</span><span class="w"></span>
<span class="w">      </span><span class="p">});</span><span class="w"></span>
<span class="w">  </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>This should be familiar to the reader who has read through the preceding
<a class="reference internal" href="launch_basic.html#tut-launchintro-label"><span class="std std-ref">RAJA::expt::Launch Basics</span></a> section of this tutorial. As the
<code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> method is templated on a host execution policy, the
<code class="docutils literal notranslate"><span class="pre">RAJA::expt::Grid</span></code> object can be defined without arguments as loop methods
will get dispatched as standard C-Style for-loops.</p>
<p>Suppose we wanted to parallelize the outer ‘k’ loop using OpenMP multithreading.
A C-style version of this is:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="cp">#pragma omp parallel for</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">k</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">aView</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>where we have placed the OpenMP directive <code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">omp</span> <span class="pre">parallel</span> <span class="pre">for</span></code> before
the outer loop of the kernel.</p>
<p>The corresponding RAJA versions of the C-style OpenMP variant is:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">omp_policy_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">omp_for_exec</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">loop_policy_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">loop_exec</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">launch_policy_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">omp_launch_t</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">launch</span><span class="o">&lt;</span><span class="n">launch_policy_2</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Grid</span><span class="p">(),</span><span class="w"> </span><span class="c1">//Grid may be empty when running on the host</span>
<span class="w">    </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="n">RAJA_HOST_DEVICE</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">omp_policy_2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">loop_policy_2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">loop_policy_2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">                </span><span class="n">aView</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="p">});</span><span class="w"></span>
<span class="w">         </span><span class="p">});</span><span class="w"></span>
<span class="w">      </span><span class="p">});</span><span class="w"></span>
<span class="w">  </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>With the OpenMP version above, <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> method is templated with
a <code class="docutils literal notranslate"><span class="pre">RAJA::expt::omp_launch_t</span></code> execution policy. The policy is used
to create an OpenMP parallel region, loop iterations may then be distributed
using <code class="docutils literal notranslate"><span class="pre">RAJA::expt::loop</span></code> methods templated on <code class="docutils literal notranslate"><span class="pre">RAJA::omp_for_exec</span></code>
execution policies. As before, the <code class="docutils literal notranslate"><span class="pre">RAJA::expt::Grid</span></code> object may be
initialized without grid dimensions as the CPU does not require specifying a
compute grid.</p>
<p>The first RAJA-based kernel for parallel GPU execution using the RAJA CUDA
back-end we introduce is:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_teams_z_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_block_z_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_global_thread_y_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">cuda_global_thread_y</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_global_thread_x_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">cuda_global_thread_x</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">async_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">launch_policy_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">cuda_launch_t</span><span class="o">&lt;</span><span class="n">async_3</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">launch</span><span class="o">&lt;</span><span class="n">launch_policy_3</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Grid</span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Teams</span><span class="p">(</span><span class="n">n_blocks_i</span><span class="w"> </span><span class="p">,</span><span class="n">n_blocks_j</span><span class="p">,</span><span class="w"> </span><span class="n">n_blocks_k</span><span class="p">),</span><span class="w"></span>
<span class="w">                      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Threads</span><span class="p">(</span><span class="n">i_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">j_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">k_block_sz</span><span class="p">)),</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="n">RAJA_HOST_DEVICE</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">cuda_teams_z_3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">cuda_global_thread_y_3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">cuda_global_thread_x_3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="n">aView</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">;</span><span class="w"></span>

<span class="w">          </span><span class="p">});</span><span class="w"></span>
<span class="w">        </span><span class="p">});</span><span class="w"></span>
<span class="w">      </span><span class="p">});</span><span class="w"></span>
<span class="w">  </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>where we have defined the CUDA thread-block dimensions as:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">block_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i_block_sz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j_block_sz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">block_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">i_block_sz</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k_block_sz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_blocks_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA_DIVIDE_CEILING_INT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">i_block_sz</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_blocks_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA_DIVIDE_CEILING_INT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">j_block_sz</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_blocks_k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA_DIVIDE_CEILING_INT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">k_block_sz</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Here, we use the <code class="docutils literal notranslate"><span class="pre">RAJA::expt::cuda_launch_t</span></code> policy type to
indicate that we want a CUDA kernel to be launched. The ‘k’, ‘j’, ‘i’
iteration variables are mapped to CUDA threads and blocks using the CUDA
execution policy types <code class="docutils literal notranslate"><span class="pre">RAJA::cuda_block_z_direct</span></code>,
<code class="docutils literal notranslate"><span class="pre">RAJA::expt::cuda_global_thread_y</span></code>, and <code class="docutils literal notranslate"><span class="pre">RAJA::expt::cuda_global_thread_x</span></code>,
respectively. Thus, we use a two-dimensional CUDA thread-block and
three-dimensional compute grid to map the loop iterations to CUDA threads. In
comparison to the RAJA CUDA example in <a class="reference internal" href="kernel_exec_pols.html#tut-kernelexecpols-label"><span class="std std-ref">RAJA::kernel Execution Policies</span></a> ,
<code class="docutils literal notranslate"><span class="pre">RAJA::expt::loop</span></code> methods support execution policies which enable mapping
directly to the global thread ID of a compute grid.</p>
<p>Using a combination of <code class="docutils literal notranslate"><span class="pre">RAJA::expt::tile</span></code> and <code class="docutils literal notranslate"><span class="pre">RAJA::expt::loop</span></code> methods,
we can create a loop tiling platform portable implementation. Here, is a
CUDA variant:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_teams_z_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_block_z_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_teams_y_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_block_y_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_teams_x_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_block_x_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_threads_y_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_thread_y_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_threads_x_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_thread_x_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">async_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">launch_policy_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">cuda_launch_t</span><span class="o">&lt;</span><span class="n">async_4</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">launch</span><span class="o">&lt;</span><span class="n">launch_policy_4</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Grid</span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Teams</span><span class="p">(</span><span class="n">n_blocks_i</span><span class="p">,</span><span class="w"> </span><span class="n">n_blocks_j</span><span class="p">,</span><span class="w"> </span><span class="n">n_blocks_k</span><span class="p">),</span><span class="w"></span>
<span class="w">                      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Threads</span><span class="p">(</span><span class="n">i_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">j_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">k_block_sz</span><span class="p">)),</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="n">RAJA_HOST_DEVICE</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">cuda_teams_z_4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">tile</span><span class="o">&lt;</span><span class="n">cuda_teams_y_4</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">j_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">j_tile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">          </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">tile</span><span class="o">&lt;</span><span class="n">cuda_teams_x_4</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">i_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i_tile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">cuda_threads_y_4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">j_tile</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">cuda_threads_x_4</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">i_tile</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">                    </span><span class="n">aView</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">;</span><span class="w"></span>

<span class="w">                  </span><span class="p">});</span><span class="w"></span>
<span class="w">              </span><span class="p">});</span><span class="w"></span>

<span class="w">            </span><span class="p">});</span><span class="w"></span>
<span class="w">          </span><span class="p">});</span><span class="w"></span>

<span class="w">      </span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>We consider the kernel to be portable, because all of the execution policy types
and execution parameters can be replaced by other types and values without
changing the kernel code directly.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">RAJA::expt::tile</span></code> methods are used to partition an iteration space into
tiles to be used within a <code class="docutils literal notranslate"><span class="pre">RAJA::expt::loop</span></code> method. The ‘{i,j,k}_block_sz’
arguments passed to the <code class="docutils literal notranslate"><span class="pre">RAJA::expt::tile</span></code> function specify the tile size
for each loop. In the case of GPU programming models, we define the tile size
to correspond to the number of threads in a given dimension. Execution tile
and loop execution policies are chosen to have CUDA blocks and threads map
directly to tiles and entries in a tile.</p>
<p>For context and comparison, here is the same kernel implementation using
CUDA directly:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dim3</span><span class="w"> </span><span class="nf">nthreads_per_block</span><span class="p">(</span><span class="n">i_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">j_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">k_block_sz</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">static_assert</span><span class="p">(</span><span class="n">i_block_sz</span><span class="o">*</span><span class="n">j_block_sz</span><span class="o">*</span><span class="n">k_block_sz</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">block_size</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;Invalid block_size&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">dim3</span><span class="w"> </span><span class="nf">nblocks</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">RAJA_DIVIDE_CEILING_INT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">i_block_sz</span><span class="p">)),</span><span class="w"></span>
<span class="w">               </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">RAJA_DIVIDE_CEILING_INT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">j_block_sz</span><span class="p">)),</span><span class="w"></span>
<span class="w">               </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">RAJA_DIVIDE_CEILING_INT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">k_block_sz</span><span class="p">)));</span><span class="w"></span>

<span class="w">  </span><span class="n">nested_init</span><span class="o">&lt;</span><span class="n">i_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">j_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">k_block_sz</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="o">&lt;&lt;&lt;</span><span class="n">nblocks</span><span class="p">,</span><span class="w"> </span><span class="n">nthreads_per_block</span><span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">cudaErrchk</span><span class="p">(</span><span class="w"> </span><span class="n">cudaGetLastError</span><span class="p">()</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">cudaErrchk</span><span class="p">(</span><span class="n">cudaDeviceSynchronize</span><span class="p">());</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">nested_init</span></code> device kernel used here is:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i_block_size</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j_block_size</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k_block_size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
<span class="n">__launch_bounds__</span><span class="p">(</span><span class="n">i_block_size</span><span class="o">*</span><span class="n">j_block_size</span><span class="o">*</span><span class="n">k_block_size</span><span class="p">)</span><span class="w"></span>
<span class="n">__global__</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">nested_init</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i_block_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">j_block_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">threadIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blockIdx</span><span class="p">.</span><span class="n">z</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">k</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>A few differences between the CUDA and RAJA-CUDA versions are worth noting.
First, the CUDA version uses the CUDA <code class="docutils literal notranslate"><span class="pre">dim3</span></code> construct to express the
threads-per-block and number of thread-blocks to use: i.e., the
<code class="docutils literal notranslate"><span class="pre">nthreads_per_block</span></code> and <code class="docutils literal notranslate"><span class="pre">nblocks</span></code> variable definitions. The
<code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> interface takes compute dimensions through a
<code class="docutils literal notranslate"><span class="pre">RAJA::expt::Grid</span></code> object. RAJA provides a macro <code class="docutils literal notranslate"><span class="pre">RAJA_DIVIDE_CEILING_INT</span></code>
to perform the proper integer arithmetic to calculate the number of blocks
based on the size of the array and the block size in each dimension. Second, the
mapping of thread identifiers to the (i,j,k) indices is explicit in the device
kernel. Third, an explicit check of the (i,j,k) values is required in the CUDA
implementation to avoid addressing memory out-of-bounds; i.e.,
<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(</span> <span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">N</span> <span class="pre">&amp;&amp;</span> <span class="pre">j</span> <span class="pre">&lt;</span> <span class="pre">N</span> <span class="pre">&amp;&amp;</span> <span class="pre">k</span> <span class="pre">&lt;</span> <span class="pre">N</span> <span class="pre">)...</span></code>. The RAJA variants set similar
definitions internally and <strong>mask out indices that would be out-of-bounds.</strong>
Note that we also inserted additional error checking with <code class="docutils literal notranslate"><span class="pre">static_assert</span></code>
and <code class="docutils literal notranslate"><span class="pre">cudaErrchk</span></code>, which is a RAJA macro, for printing CUDA device error
codes, to catch device errors if there are any.</p>
<p>Lastly, we show the RAJA HIP variants of the kernel, which are semantically
identical to the RAJA CUDA variants. First, the RAJA-HIP global-thread
variant:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">hip_teams_z_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">hip_block_z_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">hip_global_thread_y_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">hip_global_thread_y</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">hip_global_thread_x_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">hip_global_thread_x</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">async_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">launch_policy_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">hip_launch_t</span><span class="o">&lt;</span><span class="n">async_5</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">launch</span><span class="o">&lt;</span><span class="n">launch_policy_5</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Grid</span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Teams</span><span class="p">(</span><span class="n">n_blocks_i</span><span class="p">,</span><span class="w"> </span><span class="n">n_blocks_j</span><span class="p">,</span><span class="w"> </span><span class="n">n_blocks_k</span><span class="p">),</span><span class="w"></span>
<span class="w">                      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Threads</span><span class="p">(</span><span class="n">i_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">j_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">k_block_sz</span><span class="p">)),</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="n">RAJA_HOST_DEVICE</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">       </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">hip_teams_z_5</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">           </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">hip_global_thread_y_5</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">hip_global_thread_x_5</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">                   </span><span class="n">d_aView</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">;</span><span class="w"></span>

<span class="w">           </span><span class="p">});</span><span class="w"></span>
<span class="w">         </span><span class="p">});</span><span class="w"></span>
<span class="w">       </span><span class="p">});</span><span class="w"></span>

<span class="w">  </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>and then the RAJA Launch HIP fixed thread-block size, tiled, direct thread
mapping version:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">hip_teams_z_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">hip_block_z_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">hip_teams_y_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">hip_block_y_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">hip_teams_x_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">hip_block_x_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">hip_threads_y_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">hip_thread_y_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">hip_threads_x_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">hip_thread_x_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">async_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">launch_policy_6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">hip_launch_t</span><span class="o">&lt;</span><span class="n">async_6</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">launch</span><span class="o">&lt;</span><span class="n">launch_policy_6</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Grid</span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Teams</span><span class="p">(</span><span class="n">n_blocks_i</span><span class="p">,</span><span class="w"> </span><span class="n">n_blocks_j</span><span class="p">,</span><span class="w"> </span><span class="n">n_blocks_k</span><span class="p">),</span><span class="w"></span>
<span class="w">                      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Threads</span><span class="p">(</span><span class="n">i_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">j_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">k_block_sz</span><span class="p">)),</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="n">RAJA_HOST_DEVICE</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">hip_teams_z_6</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">tile</span><span class="o">&lt;</span><span class="n">hip_teams_y_6</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">j_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">j_tile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">          </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">tile</span><span class="o">&lt;</span><span class="n">hip_teams_x_6</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">i_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i_tile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">hip_threads_y_6</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">j_tile</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">hip_threads_x_6</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">i_tile</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">                    </span><span class="n">d_aView</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">;</span><span class="w"></span>

<span class="w">                  </span><span class="p">});</span><span class="w"></span>
<span class="w">              </span><span class="p">});</span><span class="w"></span>

<span class="w">            </span><span class="p">});</span><span class="w"></span>
<span class="w">          </span><span class="p">});</span><span class="w"></span>

<span class="w">      </span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>The only differences are that type names are changed to replace ‘CUDA’ types
with ‘HIP’ types to use the RAJA HIP back-end.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="launch_basic.html" class="btn btn-neutral float-left" title="RAJA::expt::Launch Basics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="launch_naming_kernels.html" class="btn btn-neutral float-right" title="Naming kernels for NVTX/ROCTX tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Lawrence Livermore National Security, LLNS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>